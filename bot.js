// ===================================================
// ğŸš€ AI GOAL PREDICTOR ULTIMATE - VERSION 15.4
// ğŸ‘¤ DEVELOPER: AMIN - @GEMZGOOLBOT
// ğŸ”¥ FEATURES: DUAL PAYMENT SYSTEM + BANK TRANSFER + BINANCE
// ===================================================

console.log('ğŸ¤– Starting AI GOAL Predictor Ultimate v15.4...');
console.log('ğŸ•’ ' + new Date().toISOString());

// ğŸ”§ CONFIGURATION - UPDATED FOR DUAL PAYMENT
const CONFIG = {
    BOT_TOKEN: process.env.BOT_TOKEN || "8125363786:AAFZaOGSAvq_p8Sc8cq2bIKZlpe4ej7tmdU",
    ADMIN_ID: process.env.ADMIN_ID || "6565594143",
    CHANNEL_ID: process.env.CHANNEL_ID || "-1003283663811",
    CHANNEL_USERNAME: process.env.CHANNEL_USERNAME || "@GEMZGOOL",
    
    // ğŸ§  AI APIS
    AI_APIS: {
        GEMINI: process.env.GEMINI_API_KEY || "AIzaSyCtjtT98-M5v6t8qICPSDw-1TLwPneyaQc",
        OPENAI: process.env.OPENAI_API_KEY || "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"
    },

    // ğŸ’° DEFAULT PRICING - DUAL SYSTEM
    SUBSCRIPTION_PRICES: {
        binance: {
            week: 10,
            month: 30,
            three_months: 80,
            year: 250
        },
        bank: {
            week: 10,
            month: 30, 
            three_months: 80,
            year: 250
        }
    },

    // ğŸ” DEFAULT PAYMENT LINKS - DUAL SYSTEM
    PAYMENT_LINKS: {
        binance: {
            week: process.env.PAYMENT_WEEK || "https://binance.com/payment/weekly",
            month: process.env.PAYMENT_MONTH || "https://binance.com/payment/monthly", 
            three_months: process.env.PAYMENT_3MONTHS || "https://binance.com/payment/3months",
            year: process.env.PAYMENT_YEAR || "https://binance.com/payment/yearly"
        },
        bank: {
            week: {
                account: "1234567890",
                image: "https://i.ibb.co/default-bank-week.jpg",
                description: "ğŸ”¹ ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ - Ø¨Ø§Ù‚Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©\nğŸ’³ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: 1234567890\nğŸ¦ Ø§Ù„Ø¨Ù†Ùƒ: Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ\nğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: 10$\nğŸ’µ Ø§Ù„Ø¹Ù…Ù„Ø©: Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ\n\nğŸ“‹ Ø§Ù„Ø´Ø±ÙˆØ·:\nâ€¢ ÙŠØ¬Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ\nâ€¢ Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹\nâ€¢ ÙƒØªØ§Ø¨Ø© Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ 1xBet Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ"
            },
            month: {
                account: "1234567890",
                image: "https://i.ibb.co/default-bank-month.jpg", 
                description: "ğŸ”¹ ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ - Ø¨Ø§Ù‚Ø© Ø´Ù‡Ø±ÙŠØ©\nğŸ’³ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: 1234567890\nğŸ¦ Ø§Ù„Ø¨Ù†Ùƒ: Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ\nğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: 30$\nğŸ’µ Ø§Ù„Ø¹Ù…Ù„Ø©: Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ\n\nğŸ“‹ Ø§Ù„Ø´Ø±ÙˆØ·:\nâ€¢ ÙŠØ¬Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ\nâ€¢ Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹\nâ€¢ ÙƒØªØ§Ø¨Ø© Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ 1xBet Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ"
            },
            three_months: {
                account: "1234567890",
                image: "https://i.ibb.co/default-bank-3months.jpg",
                description: "ğŸ”¹ ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ - Ø¨Ø§Ù‚Ø© 3 Ø£Ø´Ù‡Ø±\nğŸ’³ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: 1234567890\nğŸ¦ Ø§Ù„Ø¨Ù†Ùƒ: Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ\nğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: 80$\nğŸ’µ Ø§Ù„Ø¹Ù…Ù„Ø©: Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ\n\nğŸ“‹ Ø§Ù„Ø´Ø±ÙˆØ·:\nâ€¢ ÙŠØ¬Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ\nâ€¢ Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹\nâ€¢ ÙƒØªØ§Ø¨Ø© Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ 1xBet Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ"
            },
            year: {
                account: "1234567890",
                image: "https://i.ibb.co/default-bank-year.jpg",
                description: "ğŸ”¹ ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ - Ø¨Ø§Ù‚Ø© Ø³Ù†ÙˆÙŠØ©\nğŸ’³ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: 1234567890\nğŸ¦ Ø§Ù„Ø¨Ù†Ùƒ: Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ\nğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: 250$\nğŸ’µ Ø§Ù„Ø¹Ù…Ù„Ø©: Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ\n\nğŸ“‹ Ø§Ù„Ø´Ø±ÙˆØ·:\nâ€¢ ÙŠØ¬Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ\nâ€¢ Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹\nâ€¢ ÙƒØªØ§Ø¨Ø© Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ 1xBet Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ"
            }
        }
    },
    
    VERSION: "15.4.0",
    DEVELOPER: "AMIN - @GEMZGOOLBOT",
    CHANNEL: "@GEMZGOOL",
    START_IMAGE: "https://i.ibb.co/tpy70Bd1/IMG-20251104-074214-065.jpg",
    ANALYSIS_IMAGE: "https://i.ibb.co/VYjf05S0/Screenshot.png",
    PREDICTION_IMAGE: "https://i.ibb.co/rGTZm2mB/IMG.jpg",
    IMGBB_API_KEY: process.env.IMGBB_API_KEY || "42b155a527bee21e62e524a31fe9b1ee"
};

console.log('âœ… Dual Payment Configuration loaded successfully');

// ... (Ø¨Ù‚ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ Ø­ØªÙ‰ Ø¬Ø²Ø¡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª)

// ğŸ—„ï¸ LOCAL STORAGE FALLBACK - UPDATED FOR DUAL PAYMENT
const userDatabase = new Map();
const paymentDatabase = new Map();
const settingsDatabase = new Map();

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬
settingsDatabase.set('config', {
    prices: { 
        binance: { ...CONFIG.SUBSCRIPTION_PRICES.binance },
        bank: { ...CONFIG.SUBSCRIPTION_PRICES.bank }
    },
    payment_links: { 
        binance: { ...CONFIG.PAYMENT_LINKS.binance },
        bank: { ...CONFIG.PAYMENT_LINKS.bank }
    },
    maintenance_mode: false,
    updated_at: new Date().toISOString()
});

// ... (Ø¨Ù‚ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ Ø­ØªÙ‰ Ø¬Ø²Ø¡ DatabaseManager)

// ğŸ’¾ DATABASE MANAGER - UPDATED FOR DUAL PAYMENT
class DatabaseManager {
    constructor() {
        this.maintenanceMode = false;
    }

    // ... (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ)

    async getSettings() {
        try {
            if (db) {
                const settingsDoc = await db.collection('settings').doc('config').get();
                if (settingsDoc.exists) {
                    return settingsDoc.data();
                }
            }
            return settingsDatabase.get('config') || {
                prices: { 
                    binance: { ...CONFIG.SUBSCRIPTION_PRICES.binance },
                    bank: { ...CONFIG.SUBSCRIPTION_PRICES.bank }
                },
                payment_links: { 
                    binance: { ...CONFIG.PAYMENT_LINKS.binance },
                    bank: { ...CONFIG.PAYMENT_LINKS.bank }
                },
                maintenance_mode: false,
                updated_at: new Date().toISOString()
            };
        } catch (error) {
            return settingsDatabase.get('config') || {
                prices: { 
                    binance: { ...CONFIG.SUBSCRIPTION_PRICES.binance },
                    bank: { ...CONFIG.SUBSCRIPTION_PRICES.bank }
                },
                payment_links: { 
                    binance: { ...CONFIG.PAYMENT_LINKS.binance },
                    bank: { ...CONFIG.PAYMENT_LINKS.bank }
                },
                maintenance_mode: false,
                updated_at: new Date().toISOString()
            };
        }
    }

    async updateSettings(newSettings) {
        try {
            const updatedSettings = {
                ...newSettings,
                updated_at: new Date().toISOString()
            };

            if (db) {
                await db.collection('settings').doc('config').set(updatedSettings, { merge: true });
            }
            settingsDatabase.set('config', updatedSettings);
            return updatedSettings;
        } catch (error) {
            const updatedSettings = {
                ...newSettings,
                updated_at: new Date().toISOString()
            };
            settingsDatabase.set('config', updatedSettings);
            return updatedSettings;
        }
    }

    // ... (Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„ ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ)
}

// ... (Ø¨Ù‚ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ Ø­ØªÙ‰ Ø¬Ø²Ø¡ Ù„ÙˆØ­Ø§Øª Ø§Ù„Ù…ÙØ§ØªÙŠØ­)

// ğŸ¯ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø«Ø§Ø¨ØªØ© - UPDATED FOR DUAL PAYMENT
const getMainKeyboard = () => {
    return Markup.keyboard([
        ['ğŸ¯ Ø¬Ù„Ø¨ Ø§Ù„ØªØ­Ù„ÙŠÙ„', 'ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙŠ'],
        ['ğŸ’³ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª', 'ğŸ‘¥ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨ÙˆØª'],
        ['ğŸ‘¤ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ', 'ğŸ†˜ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ']
    ]).resize();
};

const getLoginKeyboard = () => {
    return Markup.keyboard([
        ['ğŸ” Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨']
    ]).resize();
};

// ğŸ†• Ù„ÙˆØ­Ø© Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
const getPaymentMethodKeyboard = () => {
    return Markup.keyboard([
        ['ğŸ’³ Ø¨Ø§ÙŠÙ†Ø§Ù†Ø³', 'ğŸ¦ ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ'],
        ['ğŸ”™ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©']
    ]).resize();
};

const getSubscriptionKeyboard = () => {
    return Markup.keyboard([
        ['ğŸ’° Ø£Ø³Ø¨ÙˆØ¹ÙŠ', 'ğŸ’° Ø´Ù‡Ø±ÙŠ'],
        ['ğŸ’° 3 Ø£Ø´Ù‡Ø±', 'ğŸ’° Ø³Ù†ÙˆÙŠ'],
        ['ğŸ”™ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©']
    ]).resize();
};

const getAdminMainKeyboard = () => {
    return Markup.keyboard([
        ['ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…', 'ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†'],
        ['ğŸ’° Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹', 'âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª'],
        ['ğŸ“¢ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±', 'ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…'],
        ['ğŸ”§ Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„Ø¨ÙˆØª', 'ğŸ”™ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø¥Ø¯Ù…Ù†']
    ]).resize();
};

const getAdminUsersKeyboard = () => {
    return Markup.keyboard([
        ['ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', 'âœ… Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†'],
        ['ğŸ†“ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠÙ†', 'ğŸ“ˆ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†'],
        ['ğŸ”™ Ø±Ø¬ÙˆØ¹']
    ]).resize();
};

const getAdminPaymentsKeyboard = () => {
    return Markup.keyboard([
        ['ğŸ“¥ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©', 'âœ… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø©'],
        ['âŒ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©', 'ğŸ“‹ ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª'],
        ['ğŸ”™ Ø±Ø¬ÙˆØ¹']
    ]).resize();
};

const getAdminSettingsKeyboard = () => {
    return Markup.keyboard([
        ['ğŸ’° ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ø¯ÙØ¹', 'âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©'],
        ['ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†', 'ğŸ”™ Ø±Ø¬ÙˆØ¹']
    ]).resize();
};

const getAdminPaymentTypesKeyboard = () => {
    return Markup.keyboard([
        ['ğŸ’° Ø£Ø³Ø¨ÙˆØ¹ÙŠ', 'ğŸ’° Ø´Ù‡Ø±ÙŠ'],
        ['ğŸ’° 3 Ø£Ø´Ù‡Ø±', 'ğŸ’° Ø³Ù†ÙˆÙŠ'],
        ['ğŸ”™ Ø±Ø¬ÙˆØ¹']
    ]).resize();
};

// ğŸ†• Ù„ÙˆØ­Ø© Ø§Ø®ØªÙŠØ§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹ ÙÙŠ Ø§Ù„Ø¥Ø¯Ù…Ù†
const getAdminPaymentSystemKeyboard = () => {
    return Markup.keyboard([
        ['ğŸ’³ Ù†Ø¸Ø§Ù… Ø¨Ø§ÙŠÙ†Ø§Ù†Ø³', 'ğŸ¦ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ'],
        ['ğŸ”™ Ø±Ø¬ÙˆØ¹']
    ]).resize();
};

// ... (Ø¨Ù‚ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ Ø­ØªÙ‰ Ø¬Ø²Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†ØµÙˆØµ)

// ğŸ“ HANDLE TEXT MESSAGES - UPDATED FOR DUAL PAYMENT
bot.on('text', async (ctx) => {
    try {
        const settings = await dbManager.getSettings();
        if (settings.maintenance_mode && ctx.from.id.toString() !== CONFIG.ADMIN_ID) {
            await ctx.replyWithMarkdown('ğŸ”§ *Ø§Ù„Ø¨ÙˆØª ØªØ­Øª Ø§Ù„ØµÙŠØ§Ù†Ø©*\n\nâ° Ù†Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø®Ø¯Ù…Ø© Ù„ÙƒÙ…\nğŸ”„ Ø³Ù†Ø¹ÙˆØ¯ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ø¨Ø£ÙØ¶Ù„ Ù…Ù…Ø§ ÙƒØ§Ù†\n\nğŸ“ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: ' + CONFIG.DEVELOPER);
            return;
        }

        const text = ctx.message.text;
        const session = ctx.session;
        const userId = ctx.from.id.toString();

        // ... (Ø¨Ù‚ÙŠØ© ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø¯Ù…Ù† ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ)

        // ğŸ†• Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
        if (session.step === 'choose_payment_method') {
            if (text === 'ğŸ’³ Ø¨Ø§ÙŠÙ†Ø§Ù†Ø³') {
                ctx.session.paymentSystem = 'binance';
                ctx.session.step = 'verified';
                await handleSubscriptions(ctx, session.userData);
                return;
            }
            else if (text === 'ğŸ¦ ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ') {
                ctx.session.paymentSystem = 'bank';
                ctx.session.step = 'verified';
                await handleSubscriptions(ctx, session.userData);
                return;
            }
            else if (text === 'ğŸ”™ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©') {
                ctx.session.step = 'verified';
                await ctx.replyWithMarkdown('ğŸ”™ *Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©*', getMainKeyboard());
                return;
            }
        }

        // ... (Ø¨Ù‚ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ)

        // ğŸ¯ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø«Ø§Ø¨ØªØ© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚
        else if (session.step === 'verified') {
            const userData = await dbManager.getUser(userId);
            
            if (!userData) {
                await ctx.replyWithMarkdown('âŒ *Ø¬Ù„Ø³Ø© Ù…Ù†ØªÙ‡ÙŠØ©*\n\nğŸ” Ø£Ø±Ø³Ù„ /start Ù„Ù„Ø¨Ø¯Ø¡', getLoginKeyboard());
                return;
            }

            switch (text) {
                case 'ğŸ¯ Ø¬Ù„Ø¨ Ø§Ù„ØªØ­Ù„ÙŠÙ„':
                    await handleGetPrediction(ctx, userData);
                    break;

                case 'ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙŠ':
                    await handleUserStats(ctx, userData);
                    break;

                case 'ğŸ‘¥ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨ÙˆØª':
                    await handleBotStats(ctx);
                    break;

                case 'ğŸ’³ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª':
                    // ğŸ†• Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø£ÙˆÙ„Ø§Ù‹
                    ctx.session.step = 'choose_payment_method';
                    await ctx.replyWithMarkdown(
                        'ğŸ’³ *Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹*\n\n' +
                        'ğŸ”¹ Ø§Ø®ØªØ± Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø¯ÙØ¹:\n\n' +
                        'ğŸ’³ *Ø¨Ø§ÙŠÙ†Ø§Ù†Ø³* - Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± Ù…Ù†ØµØ© Ø¨Ø§ÙŠÙ†Ø§Ù†Ø³\n' +
                        'ğŸ¦ *ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ* - Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…ÙŠ\n\n' +
                        'ğŸ“‹ Ø§Ø®ØªØ± Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙŠ ØªÙ†Ø§Ø³Ø¨Ùƒ:',
                        getPaymentMethodKeyboard()
                    );
                    break;

                case 'ğŸ‘¤ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ':
                    await handleSubscriptionStatus(ctx, userData);
                    break;

                case 'ğŸ†˜ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ':
                    await ctx.replyWithMarkdown(
                        `ğŸ†˜ *Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ*\n\n` +
                        `ğŸ“ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø¯Ø¹Ù…:\n` +
                        `ğŸ‘¤ ${CONFIG.DEVELOPER}\n` +
                        `ğŸ“¢ ${CONFIG.CHANNEL}\n\n` +
                        `â° Ù…ØªØ§Ø­ÙˆÙ† 24/7 Ù„Ø®Ø¯Ù…ØªÙƒÙ…`,
                        getMainKeyboard()
                    );
                    break;

                case 'ğŸ”™ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©':
                    await ctx.replyWithMarkdown('ğŸ”™ *Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©*', getMainKeyboard());
                    break;

                default:
                    if (text.startsWith('ğŸ’° ')) {
                        await handleSubscriptionSelection(ctx, userData, text);
                    } else {
                        await ctx.replyWithMarkdown('ğŸ”™ *Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©*', getMainKeyboard());
                    }
                    break;
            }
        }

        // ... (Ø¨Ù‚ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ)

    } catch (error) {
        console.error('Text handler error:', error);
        await ctx.replyWithMarkdown('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹', getMainKeyboard());
    }
});

// ğŸ†• HANDLE SUBSCRIPTION SELECTION - UPDATED FOR DUAL PAYMENT
async function handleSubscriptionSelection(ctx, userData, text) {
    const subscriptionTypeMap = {
        'ğŸ’° Ø£Ø³Ø¨ÙˆØ¹ÙŠ': 'week',
        'ğŸ’° Ø´Ù‡Ø±ÙŠ': 'month', 
        'ğŸ’° 3 Ø£Ø´Ù‡Ø±': 'three_months',
        'ğŸ’° Ø³Ù†ÙˆÙŠ': 'year'
    };

    const subscriptionType = subscriptionTypeMap[text];
    if (!subscriptionType) {
        await ctx.replyWithMarkdown('âŒ *Ø§Ø®ØªÙŠØ§Ø± ØºÙŠØ± ØµØ­ÙŠØ­*', getSubscriptionKeyboard());
        return;
    }

    try {
        const settings = await dbManager.getSettings();
        const paymentSystem = ctx.session.paymentSystem || 'binance'; // Default to binance
        
        if (paymentSystem === 'binance') {
            // Ù†Ø¸Ø§Ù… Ø¨Ø§ÙŠÙ†Ø§Ù†Ø³ (ÙƒÙ…Ø§ Ù‡Ùˆ)
            const prices = settings.prices.binance;
            const payment_links = settings.payment_links.binance;

            const displayName = text.replace('ğŸ’° ', '');
            
            const paymentLink = payment_links[subscriptionType];
            const isImage = paymentLink && (paymentLink.includes('.jpg') || paymentLink.includes('.png') || paymentLink.includes('.jpeg') || paymentLink.includes('.gif') || paymentLink.includes('imgbb') || paymentLink.includes('i.ibb.co') || paymentLink.startsWith('https://i.ibb.co'));

            if (isImage) {
                const subscriptionMessage = `ğŸ’³ *Ø¨Ø§Ù‚Ø© ${displayName} - Ø¨Ø§ÙŠÙ†Ø§Ù†Ø³*\n\n` +
                    `ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${prices[subscriptionType]}$\n` +
                    `â° Ø§Ù„Ù…Ø¯Ø©: ${getSubscriptionDuration(subscriptionType)}\n\n` +
                    `ğŸ“‹ *Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:*\n` +
                    `ğŸ’³ Ø§Ø¯ÙØ¹ Ø¨Ø§Ù„Ù…Ø³Ø­ Ø¹Ø¨Ø± Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§\n` +
                    `ğŸ“± Ø£Ùˆ Ø§Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù…ÙˆØ§ØµÙ„Ø© Ø§Ù„Ø¯ÙØ¹\n\n` +
                    `ğŸ’¡ *Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø§Ù‚Ø©ØŸ*`;

                try {
                    await ctx.replyWithPhoto(paymentLink, {
                        caption: subscriptionMessage,
                        parse_mode: 'Markdown',
                        reply_markup: {
                            inline_keyboard: [
                                [ { text: 'âœ… Ù†Ø¹Ù…ØŒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©', callback_data: `confirm_binance_${subscriptionType}` } ],
                                [ { text: 'ğŸ”™ Ø±Ø¬ÙˆØ¹', callback_data: 'back_to_subscriptions' } ]
                            ]
                        }
                    });
                } catch (photoError) {
                    console.error('Error sending payment image:', photoError);
                    await ctx.replyWithMarkdown(
                        `âŒ *ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø§Ù„Ø¯ÙØ¹*\n\n${subscriptionMessage}`,
                        {
                            reply_markup: {
                                inline_keyboard: [
                                    [ { text: 'âœ… Ù†Ø¹Ù…ØŒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©', callback_data: `confirm_binance_${subscriptionType}` } ],
                                    [ { text: 'ğŸ”™ Ø±Ø¬ÙˆØ¹', callback_data: 'back_to_subscriptions' } ]
                                ]
                            }
                        }
                    );
                }
            } else {
                const subscriptionMessage = `ğŸ’³ *Ø¨Ø§Ù‚Ø© ${displayName} - Ø¨Ø§ÙŠÙ†Ø§Ù†Ø³*\n\n` +
                    `ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${prices[subscriptionType]}$\n` +
                    `â° Ø§Ù„Ù…Ø¯Ø©: ${getSubscriptionDuration(subscriptionType)}\n\n` +
                    `ğŸ”— *Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯ÙØ¹:* ${paymentLink}\n\n` +
                    `ğŸ“‹ *Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:*\n` +
                    `1. Ø§Ø¯ÙØ¹ Ø¹Ø¨Ø± Ø§Ù„Ø±Ø§Ø¨Ø· Ø£Ø¹Ù„Ø§Ù‡\n` +
                    `2. Ø£Ø±Ø³Ù„ Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ 1xBet (10 Ø£Ø±Ù‚Ø§Ù…)\n` +
                    `3. Ø£Ø±Ø³Ù„ ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹\n` +
                    `4. Ø§Ù†ØªØ¸Ø± Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©\n\n` +
                    `ğŸ’¡ *Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø§Ù‚Ø©ØŸ*`;

                await ctx.replyWithMarkdown(subscriptionMessage, {
                    reply_markup: {
                        inline_keyboard: [
                            [ { text: 'âœ… Ù†Ø¹Ù…ØŒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©', callback_data: `confirm_binance_${subscriptionType}` } ],
                            [ { text: 'ğŸ”™ Ø±Ø¬ÙˆØ¹', callback_data: 'back_to_subscriptions' } ]
                        ]
                    }
                });
            }
        } 
        else if (paymentSystem === 'bank') {
            // ğŸ†• Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            const prices = settings.prices.bank;
            const bankDetails = settings.payment_links.bank[subscriptionType];

            const displayName = text.replace('ğŸ’° ', '');
            
            const subscriptionMessage = `ğŸ¦ *Ø¨Ø§Ù‚Ø© ${displayName} - ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ*\n\n` +
                `ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${prices[subscriptionType]}$\n` +
                `â° Ø§Ù„Ù…Ø¯Ø©: ${getSubscriptionDuration(subscriptionType)}\n\n` +
                `ğŸ’³ *Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ:*\n` +
                `${bankDetails.description}\n\n` +
                `ğŸ’¡ *Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø§Ù‚Ø©ØŸ*`;

            // Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø§Ù„Ø¨Ù†Ùƒ Ø¥Ø°Ø§ Ù…ÙˆØ¬ÙˆØ¯Ø©
            if (bankDetails.image && bankDetails.image.startsWith('http')) {
                try {
                    await ctx.replyWithPhoto(bankDetails.image, {
                        caption: subscriptionMessage,
                        parse_mode: 'Markdown',
                        reply_markup: {
                            inline_keyboard: [
                                [ { text: 'âœ… Ù†Ø¹Ù…ØŒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©', callback_data: `confirm_bank_${subscriptionType}` } ],
                                [ { text: 'ğŸ”™ Ø±Ø¬ÙˆØ¹', callback_data: 'back_to_subscriptions' } ]
                            ]
                        }
                    });
                } catch (photoError) {
                    console.error('Error sending bank image:', photoError);
                    await ctx.replyWithMarkdown(subscriptionMessage, {
                        reply_markup: {
                            inline_keyboard: [
                                [ { text: 'âœ… Ù†Ø¹Ù…ØŒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©', callback_data: `confirm_bank_${subscriptionType}` } ],
                                [ { text: 'ğŸ”™ Ø±Ø¬ÙˆØ¹', callback_data: 'back_to_subscriptions' } ]
                            ]
                        }
                    });
                }
            } else {
                await ctx.replyWithMarkdown(subscriptionMessage, {
                    reply_markup: {
                        inline_keyboard: [
                            [ { text: 'âœ… Ù†Ø¹Ù…ØŒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©', callback_data: `confirm_bank_${subscriptionType}` } ],
                            [ { text: 'ğŸ”™ Ø±Ø¬ÙˆØ¹', callback_data: 'back_to_subscriptions' } ]
                        ]
                    }
                });
            }
        }

    } catch (error) {
        console.error('Subscription selection error:', error);
        await ctx.replyWithMarkdown('âŒ *Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ*', getSubscriptionKeyboard());
    }
}

// ğŸ†• Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
function getSubscriptionDuration(type) {
    const durations = {
        'week': '7 Ø£ÙŠØ§Ù…',
        'month': '30 ÙŠÙˆÙ…Ø§Ù‹', 
        'three_months': '90 ÙŠÙˆÙ…Ø§Ù‹',
        'year': '365 ÙŠÙˆÙ…Ø§Ù‹'
    };
    return durations[type] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
}

// ğŸ†• Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ - UPDATED FOR DUAL PAYMENT
async function handleSubscriptionConfirmation(ctx, callbackData) {
    try {
        const userId = ctx.from.id.toString();
        const userData = await dbManager.getUser(userId);

        if (!userData) {
            await ctx.answerCbQuery('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            return;
        }

        // ÙØµÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ùƒallback
        const parts = callbackData.split('_');
        const paymentSystem = parts[1]; // binance or bank
        const subscriptionType = parts[2];

        const settings = await dbManager.getSettings();
        const prices = settings.prices[paymentSystem];

        ctx.session.paymentSystem = paymentSystem;
        ctx.session.paymentType = subscriptionType;
        ctx.session.awaitingPaymentAccount = true;

        await ctx.answerCbQuery('âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±');
        
        // Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
        await ctx.deleteMessage(ctx.callbackQuery.message.message_id);

        if (paymentSystem === 'binance') {
            await ctx.replyWithMarkdown(
                `ğŸ’³ *Ø¨Ø§Ù‚Ø© ${subscriptionType} - Ø¨Ø§ÙŠÙ†Ø§Ù†Ø³*\n\n` +
                `ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${prices[subscriptionType]}$\n\n` +
                `ğŸ” *Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ù…Ø³Ø¬Ù„:* \`${userData.onexbet}\`\n\n` +
                `ğŸ”¢ *Ø§Ù„Ø¢Ù† Ø£Ø±Ø³Ù„ Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ 1xBet Ù„Ù„ØªØ£ÙƒØ¯:*`
            );
        } 
        else if (paymentSystem === 'bank') {
            const bankDetails = settings.payment_links.bank[subscriptionType];
            
            await ctx.replyWithMarkdown(
                `ğŸ¦ *Ø¨Ø§Ù‚Ø© ${subscriptionType} - ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ*\n\n` +
                `ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${prices[subscriptionType]}$\n\n` +
                `ğŸ’³ *Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„:*\n` +
                `${bankDetails.description}\n\n` +
                `ğŸ” *Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ù…Ø³Ø¬Ù„:* \`${userData.onexbet}\`\n\n` +
                `ğŸ”¢ *Ø§Ù„Ø¢Ù† Ø£Ø±Ø³Ù„ Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ 1xBet Ù„Ù„ØªØ£ÙƒØ¯:*`
            );
        }

    } catch (error) {
        console.error('Subscription confirmation error:', error);
        await ctx.answerCbQuery('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©');
    }
}

// ğŸ†• ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§Ù„Ø¬Ø© Callback Queries
bot.on('callback_query', async (ctx) => {
    try {
        const callbackData = ctx.callbackQuery.data;
        const userId = ctx.from.id.toString();
        
        if (callbackData.startsWith('win_') || callbackData.startsWith('lose_')) {
            // ... (ÙƒÙˆØ¯ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ)
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‚Ø¨ÙˆÙ„ ÙˆØ§Ù„Ø±ÙØ¶ ÙÙŠ Ø§Ù„Ø¥Ø¯Ù…Ù†
        else if (callbackData.startsWith('accept_')) {
            const paymentId = callbackData.split('_')[1];
            await handlePaymentAccept(ctx, paymentId);
        }
        else if (callbackData.startsWith('reject_')) {
            const paymentId = callbackData.split('_')[1];
            await handlePaymentReject(ctx, paymentId);
        }
        
        // ğŸ†• Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù„Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬
        else if (callbackData.startsWith('confirm_binance_') || callbackData.startsWith('confirm_bank_')) {
            await handleSubscriptionConfirmation(ctx, callbackData);
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
        else if (callbackData === 'back_to_subscriptions') {
            await ctx.deleteMessage(ctx.callbackQuery.message.message_id);
            await ctx.replyWithMarkdown('ğŸ’³ *Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…ØªØ§Ø­Ø©*', getSubscriptionKeyboard());
        }
        
    } catch (error) {
        console.error('Callback query error:', error);
        await ctx.answerCbQuery('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©');
    }
});

// ğŸ†• ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§Ù„Ø¬Ø© ØµÙˆØ± Ø§Ù„Ø¯ÙØ¹ Ù„ØªØ´Ù…Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬
async function handlePaymentScreenshot(ctx, userId) {
    try {
        const userData = await dbManager.getUser(userId);
        const photo = ctx.message.photo[ctx.message.photo.length - 1];
        const fileLink = await bot.telegram.getFileLink(photo.file_id);
        const imageUrl = fileLink.href;

        const settings = await dbManager.getSettings();
        const paymentSystem = ctx.session.paymentSystem || 'binance';
        const prices = settings.prices[paymentSystem];

        const accountNumber = ctx.session.paymentAccount || userData.onexbet;

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† ØªØ·Ø§Ø¨Ù‚ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨
        if (accountNumber !== userData.onexbet) {
            await ctx.replyWithMarkdown(
                'âŒ *Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„Ø§ ÙŠØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ø§Ù„Ù…Ø³Ø¬Ù„!*\n\n' +
                `ğŸ” Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ù…Ø³Ø¬Ù„: \`${userData.onexbet}\`\n` +
                `ğŸ”¢ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø³Ù„: \`${accountNumber}\`\n\n` +
                'ğŸ’¡ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹ Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„ØµØ­ÙŠØ­',
                getMainKeyboard()
            );
            
            ctx.session.paymentSystem = null;
            ctx.session.paymentType = null;
            ctx.session.awaitingPaymentAccount = false;
            ctx.session.paymentAccount = null;
            return;
        }

        // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ imgbb
        const uploadResult = await imgbbUploader.uploadImageFromUrl(imageUrl);
        
        if (!uploadResult.success) {
            await ctx.replyWithMarkdown('âŒ ÙØ´Ù„ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰');
            return;
        }

        const paymentData = {
            user_id: userId,
            onexbet: accountNumber,
            screenshot_url: uploadResult.url,
            amount: prices[ctx.session.paymentType],
            subscription_type: ctx.session.paymentType,
            payment_system: paymentSystem, // ğŸ†• Ø¥Ø¶Ø§ÙØ© Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹
            username: userData.username,
            timestamp: new Date().toISOString()
        };

        const paymentId = await dbManager.addPayment(paymentData);
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¹ Ø§Ù„ØµÙˆØ±Ø©
        try {
            const paymentSystemText = paymentSystem === 'binance' ? 'Ø¨Ø§ÙŠÙ†Ø§Ù†Ø³' : 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ';
            
            await bot.telegram.sendPhoto(
                CONFIG.ADMIN_ID,
                uploadResult.url,
                {
                    caption: `ğŸ†• *Ø·Ù„Ø¨ Ø¯ÙØ¹ Ø¬Ø¯ÙŠØ¯ - ${paymentSystemText}*\n\n` +
                    `ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userData.username}\n` +
                    `ğŸ” Ø§Ù„Ø­Ø³Ø§Ø¨: ${accountNumber}\n` +
                    `ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: ${paymentData.amount}$\n` +
                    `ğŸ“¦ Ø§Ù„Ø¨Ø§Ù‚Ø©: ${ctx.session.paymentType}\n` +
                    `ğŸ’³ Ø§Ù„Ù†Ø¸Ø§Ù…: ${paymentSystemText}\n` +
                    `ğŸ†” Ø§Ù„Ø±Ù‚Ù…: ${paymentId}\n` +
                    `ğŸ“… Ø§Ù„ÙˆÙ‚Øª: ${new Date().toLocaleString('ar-EG')}`,
                    parse_mode: 'Markdown',
                    reply_markup: {
                        inline_keyboard: [
                            [
                                { text: 'âœ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ', callback_data: `accept_${paymentId}` },
                                { text: 'âŒ Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨', callback_data: `reject_${paymentId}` }
                            ]
                        ]
                    }
                }
            );
        } catch (error) {
            console.error('Error notifying admin:', error);
        }

        await ctx.replyWithMarkdown(
            'ğŸ“© *ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… ØµÙˆØ±Ø© Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­*\n\n' +
            `âœ… Ø§Ù„Ø­Ø³Ø§Ø¨: \`${accountNumber}\`\n` +
            `âœ… Ø§Ù„Ø¨Ø§Ù‚Ø©: ${ctx.session.paymentType}\n` +
            `ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: ${paymentData.amount}$\n` +
            `ğŸ’³ Ø§Ù„Ù†Ø¸Ø§Ù…: ${paymentSystem === 'binance' ? 'Ø¨Ø§ÙŠÙ†Ø§Ù†Ø³' : 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ'}\n\n` +
            'âœ… Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡Ø§ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª\n' +
            'â° Ø¹Ø§Ø¯Ø©Ù‹ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©\n\n' +
            `ğŸ“ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: ${CONFIG.DEVELOPER}`,
            getMainKeyboard()
        );

        ctx.session.paymentSystem = null;
        ctx.session.paymentType = null;
        ctx.session.awaitingPaymentAccount = false;
        ctx.session.paymentAccount = null;
    } catch (error) {
        console.error('Payment screenshot error:', error);
        await ctx.replyWithMarkdown('âŒ *Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© ØµÙˆØ±Ø© Ø§Ù„Ø¯ÙØ¹*', getMainKeyboard());
    }
}

// ğŸ†• ğŸ”§ ADMIN HANDLERS - UPDATED FOR DUAL PAYMENT SYSTEM

async function handleAdminPriceAndPaymentSettings(ctx) {
    try {
        await ctx.replyWithMarkdown(
            'ğŸ’° *ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙØ¹*\n\n' +
            'ğŸ“ Ø§Ø®ØªØ± Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ ØªØ¹Ø¯ÙŠÙ„Ù‡:',
            getAdminPaymentSystemKeyboard()
        );
        ctx.session.adminStep = 'select_payment_system';
    } catch (error) {
        console.error('Admin price and payment settings error:', error);
        await ctx.replyWithMarkdown('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„', getAdminSettingsKeyboard());
    }
}

// ğŸ†• Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø®ØªÙŠØ§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹ ÙÙŠ Ø§Ù„Ø¥Ø¯Ù…Ù†
async function handleAdminSelectPaymentSystem(ctx, text) {
    try {
        if (text === 'ğŸ”™ Ø±Ø¬ÙˆØ¹') {
            ctx.session.adminStep = 'settings';
            await ctx.replyWithMarkdown('ğŸ”™ *Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª*', getAdminSettingsKeyboard());
            return;
        }

        const paymentSystemMap = {
            'ğŸ’³ Ù†Ø¸Ø§Ù… Ø¨Ø§ÙŠÙ†Ø§Ù†Ø³': 'binance',
            'ğŸ¦ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ': 'bank'
        };

        const paymentSystem = paymentSystemMap[text];
        if (!paymentSystem) {
            await ctx.replyWithMarkdown('âŒ *Ø§Ø®ØªÙŠØ§Ø± ØºÙŠØ± ØµØ­ÙŠØ­*', getAdminPaymentSystemKeyboard());
            return;
        }

        ctx.session.adminPaymentSystem = paymentSystem;
        ctx.session.adminStep = 'select_subscription_edit';

        await ctx.replyWithMarkdown(
            `ğŸ”§ *ØªØ¹Ø¯ÙŠÙ„ ${text}*\n\n` +
            'ğŸ“ Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ ØªØ¹Ø¯ÙŠÙ„Ù‡:',
            getAdminPaymentTypesKeyboard()
        );

    } catch (error) {
        console.error('Admin select payment system error:', error);
        await ctx.replyWithMarkdown('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£', getAdminSettingsKeyboard());
    }
}

// ğŸ†• ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ø¯ÙØ¹ Ù„Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬
async function handleAdminSelectSubscriptionEdit(ctx, text) {
    try {
        const subscriptionTypeMap = {
            'ğŸ’° Ø£Ø³Ø¨ÙˆØ¹ÙŠ': 'week',
            'ğŸ’° Ø´Ù‡Ø±ÙŠ': 'month', 
            'ğŸ’° 3 Ø£Ø´Ù‡Ø±': 'three_months',
            'ğŸ’° Ø³Ù†ÙˆÙŠ': 'year'
        };

        if (text === 'ğŸ”™ Ø±Ø¬ÙˆØ¹') {
            ctx.session.adminStep = 'select_payment_system';
            await ctx.replyWithMarkdown('ğŸ”™ *Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø§Ø®ØªÙŠØ§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹*', getAdminPaymentSystemKeyboard());
            return;
        }

        const subscriptionType = subscriptionTypeMap[text];
        if (!subscriptionType) {
            await ctx.replyWithMarkdown('âŒ *Ø§Ø®ØªÙŠØ§Ø± ØºÙŠØ± ØµØ­ÙŠØ­*', getAdminPaymentTypesKeyboard());
            return;
        }

        ctx.session.editingSubscriptionType = subscriptionType;
        ctx.session.adminStep = 'edit_price_and_payment';

        const settings = await dbManager.getSettings();
        const paymentSystem = ctx.session.adminPaymentSystem;

        if (paymentSystem === 'binance') {
            const currentPrice = settings.prices.binance[subscriptionType] || CONFIG.SUBSCRIPTION_PRICES.binance[subscriptionType];
            const currentLink = settings.payment_links.binance[subscriptionType] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

            await ctx.replyWithMarkdown(
                `ğŸ”§ *ØªØ¹Ø¯ÙŠÙ„ ${text} - Ø¨Ø§ÙŠÙ†Ø§Ù†Ø³*\n\n` +
                `ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: ${currentPrice}$\n` +
                `ğŸ“ Ø±Ø§Ø¨Ø·/ØµÙˆØ±Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${currentLink}\n\n` +
                `ğŸ“ *Ø§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ†Ùƒ:*\n` +
                `â€¢ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù…Ø«Ø§Ù„: 15)\n` +
                `â€¢ Ø£Ùˆ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¯ÙØ¹ Ø¬Ø¯ÙŠØ¯\n` +
                `â€¢ Ø£Ùˆ Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© QR\n` +
                `â€¢ Ø£Ùˆ ÙƒØªØ§Ø¨Ø© "Ø¥Ù„ØºØ§Ø¡" Ù„Ù„Ø±Ø¬ÙˆØ¹\n\n` +
                `ğŸ’¡ *Ø£Ø±Ø³Ù„ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø£ÙˆÙ„Ø§Ù‹:*`
            );
        } 
        else if (paymentSystem === 'bank') {
            const currentPrice = settings.prices.bank[subscriptionType] || CONFIG.SUBSCRIPTION_PRICES.bank[subscriptionType];
            const currentBankDetails = settings.payment_links.bank[subscriptionType] || CONFIG.PAYMENT_LINKS.bank[subscriptionType];
            const currentAccount = currentBankDetails.account || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const currentImage = currentBankDetails.image || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const currentDescription = currentBankDetails.description || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

            await ctx.replyWithMarkdown(
                `ğŸ”§ *ØªØ¹Ø¯ÙŠÙ„ ${text} - ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ*\n\n` +
                `ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: ${currentPrice}$\n` +
                `ğŸ’³ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${currentAccount}\n` +
                `ğŸ–¼ï¸ ØµÙˆØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${currentImage}\n\n` +
                `ğŸ“‹ *Ø§Ù„ÙˆØµÙ Ø§Ù„Ø­Ø§Ù„ÙŠ:*\n${currentDescription}\n\n` +
                `ğŸ“ *Ø§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ†Ùƒ:*\n` +
                `â€¢ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù…Ø«Ø§Ù„: 15)\n` +
                `â€¢ Ø£Ùˆ Ø¥Ø±Ø³Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯\n` +
                `â€¢ Ø£Ùˆ Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ\n` +
                `â€¢ Ø£Ùˆ ÙƒØªØ§Ø¨Ø© "Ø¥Ù„ØºØ§Ø¡" Ù„Ù„Ø±Ø¬ÙˆØ¹\n\n` +
                `ğŸ’¡ *Ø£Ø±Ø³Ù„ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø£ÙˆÙ„Ø§Ù‹:*`
            );
        }

    } catch (error) {
        console.error('Admin select subscription edit error:', error);
        await ctx.replyWithMarkdown('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£', getAdminSettingsKeyboard());
    }
}

// ğŸ†• ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ø¯ÙØ¹ Ù„Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬
async function handleAdminEditPriceAndPayment(ctx, text) {
    try {
        if (text === 'Ø¥Ù„ØºØ§Ø¡') {
            ctx.session.adminStep = 'settings';
            ctx.session.editingSubscriptionType = null;
            ctx.session.adminPaymentSystem = null;
            await ctx.reply('ğŸ”™ *ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡*', getAdminSettingsKeyboard());
            return;
        }

        const subscriptionType = ctx.session.editingSubscriptionType;
        const paymentSystem = ctx.session.adminPaymentSystem;
        
        if (!subscriptionType || !paymentSystem) {
            await ctx.reply('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø£Ùˆ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹', getAdminSettingsKeyboard());
            return;
        }

        const settings = await dbManager.getSettings();

        if (paymentSystem === 'binance') {
            // Ù†Ø¸Ø§Ù… Ø¨Ø§ÙŠÙ†Ø§Ù†Ø³ (ÙƒÙ…Ø§ Ù‡Ùˆ)
            if (!isNaN(text) && parseFloat(text) > 0) {
                const priceNum = parseFloat(text);
                
                if (!settings.prices.binance) settings.prices.binance = {};
                settings.prices.binance[subscriptionType] = priceNum;
                await dbManager.updateSettings(settings);

                await ctx.reply(
                    `âœ… *ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± Ø¨Ù†Ø¬Ø§Ø­*\n\n` +
                    `ğŸ’° ${subscriptionType}: ${priceNum}$\n\n` +
                    `ğŸ“ *Ø§Ù„Ø¢Ù† Ø£Ø±Ø³Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø£Ùˆ ØµÙˆØ±Ø© QR:*`
                );
            }
            else if (text.startsWith('http')) {
                if (!settings.payment_links.binance) settings.payment_links.binance = {};
                settings.payment_links.binance[subscriptionType] = text;
                await dbManager.updateSettings(settings);

                await ctx.reply(
                    `âœ… *ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­!*\n\n` +
                    `ğŸ“¦ ${subscriptionType} - Ø¨Ø§ÙŠÙ†Ø§Ù†Ø³\n` +
                    `ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${settings.prices.binance[subscriptionType]}$\n` +
                    `ğŸ“ ØªÙ… Ø­ÙØ¸ ${text.startsWith('https://i.ibb.co') ? 'ØµÙˆØ±Ø© Ø§Ù„Ø¯ÙØ¹' : 'Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯ÙØ¹'} Ø¨Ù†Ø¬Ø§Ø­\n\n` +
                    `ğŸ”„ ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…`,
                    getAdminSettingsKeyboard()
                );

                ctx.session.adminStep = 'settings';
                ctx.session.editingSubscriptionType = null;
                ctx.session.adminPaymentSystem = null;
            } else {
                await ctx.reply('âŒ *Ø¥Ø¯Ø®Ø§Ù„ ØºÙŠØ± ØµØ­ÙŠØ­!*\n\nÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø³Ø¹Ø± ØµØ­ÙŠØ­ Ø£Ùˆ Ø±Ø§Ø¨Ø· ÙŠØ¨Ø¯Ø£ Ø¨Ù€ http');
            }
        } 
        else if (paymentSystem === 'bank') {
            // ğŸ†• Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            if (!isNaN(text) && parseFloat(text) > 0) {
                const priceNum = parseFloat(text);
                
                if (!settings.prices.bank) settings.prices.bank = {};
                settings.prices.bank[subscriptionType] = priceNum;
                await dbManager.updateSettings(settings);

                await ctx.reply(
                    `âœ… *ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± Ø¨Ù†Ø¬Ø§Ø­*\n\n` +
                    `ğŸ’° ${subscriptionType}: ${priceNum}$\n\n` +
                    `ğŸ“ *Ø§Ù„Ø¢Ù† Ø£Ø±Ø³Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯:*`
                );
            }
            else if (!text.startsWith('http') && text.length > 5) {
                // ÙŠØ¹ØªØ¨Ø± Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ
                if (!settings.payment_links.bank) settings.payment_links.bank = {};
                if (!settings.payment_links.bank[subscriptionType]) {
                    settings.payment_links.bank[subscriptionType] = {};
                }
                
                settings.payment_links.bank[subscriptionType].account = text;
                await dbManager.updateSettings(settings);

                await ctx.reply(
                    `âœ… *ØªÙ… ØªØ­Ø¯ÙŠØ« Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ*\n\n` +
                    `ğŸ’³ ${subscriptionType}: ${text}\n\n` +
                    `ğŸ“ *Ø§Ù„Ø¢Ù† Ø£Ø±Ø³Ù„ ØµÙˆØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø£Ùˆ Ø§ÙƒØªØ¨ "ØªØ®Ø·ÙŠ" Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©:*`
                );
                
                ctx.session.awaitingBankImage = true;
            } 
            else if (text === 'ØªØ®Ø·ÙŠ' && ctx.session.awaitingBankImage) {
                // ØªØ®Ø·ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
                ctx.session.awaitingBankImage = false;
                
                await ctx.reply(
                    `âœ… *ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­!*\n\n` +
                    `ğŸ“¦ ${subscriptionType} - ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ\n` +
                    `ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${settings.prices.bank[subscriptionType]}$\n` +
                    `ğŸ’³ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: ${settings.payment_links.bank[subscriptionType].account}\n` +
                    `ğŸ–¼ï¸ ØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©\n\n` +
                    `ğŸ”„ ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…`,
                    getAdminSettingsKeyboard()
                );

                ctx.session.adminStep = 'settings';
                ctx.session.editingSubscriptionType = null;
                ctx.session.adminPaymentSystem = null;
                ctx.session.awaitingBankImage = false;
            }
            else {
                await ctx.reply('âŒ *Ø¥Ø¯Ø®Ø§Ù„ ØºÙŠØ± ØµØ­ÙŠØ­!*\n\nÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø³Ø¹Ø± ØµØ­ÙŠØ­ Ø£Ùˆ Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ');
            }
        }

    } catch (error) {
        console.error('Admin edit price and payment error:', error);
        await ctx.reply('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„');
    }
}

// ğŸ†• Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø¨Ù†Ùƒ Ù…Ù† Ø§Ù„Ø¥Ø¯Ù…Ù†
async function handleAdminBankImageUpload(ctx, userId) {
    try {
        const subscriptionType = ctx.session.editingSubscriptionType;
        const paymentSystem = ctx.session.adminPaymentSystem;
        
        if (!subscriptionType || paymentSystem !== 'bank') {
            await ctx.reply('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø£Ùˆ Ù„ÙŠØ³ Ù†Ø¸Ø§Ù… Ø¨Ù†ÙƒÙŠ', getAdminSettingsKeyboard());
            return;
        }

        const photo = ctx.message.photo[ctx.message.photo.length - 1];
        const fileLink = await bot.telegram.getFileLink(photo.file_id);
        const imageUrl = fileLink.href;

        // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ imgbb
        const uploadResult = await imgbbUploader.uploadImageFromUrl(imageUrl);
        
        if (!uploadResult.success) {
            await ctx.reply('âŒ ÙØ´Ù„ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰');
            return;
        }

        const settings = await dbManager.getSettings();
        
        if (!settings.payment_links.bank) settings.payment_links.bank = {};
        if (!settings.payment_links.bank[subscriptionType]) {
            settings.payment_links.bank[subscriptionType] = {};
        }
        
        settings.payment_links.bank[subscriptionType].image = uploadResult.url;
        await dbManager.updateSettings(settings);

        await ctx.reply(
            `âœ… *ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­!*\n\n` +
            `ğŸ“¦ ${subscriptionType} - ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ\n` +
            `ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${settings.prices.bank[subscriptionType]}$\n` +
            `ğŸ’³ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: ${settings.payment_links.bank[subscriptionType].account}\n` +
            `ğŸ–¼ï¸ ØªÙ… ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ\n\n` +
            `ğŸ”„ ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…`,
            getAdminSettingsKeyboard()
        );

        ctx.session.adminStep = 'settings';
        ctx.session.editingSubscriptionType = null;
        ctx.session.adminPaymentSystem = null;
        ctx.session.awaitingBankImage = false;
    } catch (error) {
        console.error('Admin bank image upload error:', error);
        await ctx.reply('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©', getAdminSettingsKeyboard());
    }
}

// ğŸ†• ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ± ÙÙŠ Ø§Ù„Ø¥Ø¯Ù…Ù†
bot.on('photo', async (ctx) => {
    try {
        const userId = ctx.from.id.toString();
        const session = ctx.session;
        
        // ğŸ’³ Ù…Ø¹Ø§Ù„Ø¬Ø© ØµÙˆØ± Ø§Ù„Ø¯ÙØ¹ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙ‚Ø·
        if (session.paymentType) {
            await handlePaymentScreenshot(ctx, userId);
            return;
        }

        // ğŸ–¼ï¸ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙØ¹ ØµÙˆØ±Ø© Ù„Ù„Ø¯ÙØ¹ ÙÙŠ Ø§Ù„Ø¥Ø¯Ù…Ù†
        if (session.adminStep === 'edit_price_and_payment' && session.editingSubscriptionType) {
            if (session.adminPaymentSystem === 'binance') {
                await handleAdminPaymentImageUpload(ctx, userId);
                return;
            }
            else if (session.adminPaymentSystem === 'bank' && session.awaitingBankImage) {
                await handleAdminBankImageUpload(ctx, userId);
                return;
            }
        }

        // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø³ÙŠØ§Ù‚ Ù„Ù„ØµÙˆØ±Ø©ØŒ Ù†Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©
        await ctx.replyWithMarkdown(
            'âŒ *Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹*\n\n' +
            'ğŸ’¡ ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©',
            getMainKeyboard()
        );

    } catch (error) {
        console.error('Photo handler error:', error);
        await ctx.replyWithMarkdown('âŒ *Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©*', getMainKeyboard());
    }
});

// ğŸ†• ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬
async function handleAdminGeneralSettings(ctx) {
    try {
        const settings = await dbManager.getSettings();
        
        const generalMessage = `
âš™ï¸ *Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©*

ğŸ”§ Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª: ${settings.maintenance_mode ? 'ğŸ”’ Ù…Ù‚ÙÙ„' : 'ğŸ”“ Ù…ÙØªÙˆØ­'}
ğŸ•’ Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${new Date(settings.updated_at).toLocaleString('ar-EG')}

ğŸ’³ *Ø£Ø³Ø¹Ø§Ø± Ø¨Ø§ÙŠÙ†Ø§Ù†Ø³:*
â€¢ Ø£Ø³Ø¨ÙˆØ¹ÙŠ: ${settings.prices.binance.week}$
â€¢ Ø´Ù‡Ø±ÙŠ: ${settings.prices.binance.month}$
â€¢ 3 Ø£Ø´Ù‡Ø±: ${settings.prices.binance.three_months}$ 
â€¢ Ø³Ù†ÙˆÙŠ: ${settings.prices.binance.year}$

ğŸ¦ *Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ:*
â€¢ Ø£Ø³Ø¨ÙˆØ¹ÙŠ: ${settings.prices.bank.week}$
â€¢ Ø´Ù‡Ø±ÙŠ: ${settings.prices.bank.month}$
â€¢ 3 Ø£Ø´Ù‡Ø±: ${settings.prices.bank.three_months}$ 
â€¢ Ø³Ù†ÙˆÙŠ: ${settings.prices.bank.year}$

ğŸ”— *Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¨Ø§ÙŠÙ†Ø§Ù†Ø³:*
â€¢ Ø£Ø³Ø¨ÙˆØ¹ÙŠ: ${settings.payment_links.binance.week.startsWith('https://i.ibb.co') ? '[ØµÙˆØ±Ø©]' : settings.payment_links.binance.week}
â€¢ Ø´Ù‡Ø±ÙŠ: ${settings.payment_links.binance.month.startsWith('https://i.ibb.co') ? '[ØµÙˆØ±Ø©]' : settings.payment_links.binance.month}
â€¢ 3 Ø£Ø´Ù‡Ø±: ${settings.payment_links.binance.three_months.startsWith('https://i.ibb.co') ? '[ØµÙˆØ±Ø©]' : settings.payment_links.binance.three_months}
â€¢ Ø³Ù†ÙˆÙŠ: ${settings.payment_links.binance.year.startsWith('https://i.ibb.co') ? '[ØµÙˆØ±Ø©]' : settings.payment_links.binance.year}

ğŸ’³ *Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ:*
â€¢ Ø£Ø³Ø¨ÙˆØ¹ÙŠ: ${settings.payment_links.bank.week?.account || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
â€¢ Ø´Ù‡Ø±ÙŠ: ${settings.payment_links.bank.month?.account || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
â€¢ 3 Ø£Ø´Ù‡Ø±: ${settings.payment_links.bank.three_months?.account || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
â€¢ Ø³Ù†ÙˆÙŠ: ${settings.payment_links.bank.year?.account || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
        `;
        
        await ctx.replyWithMarkdown(generalMessage, getAdminSettingsKeyboard());
    } catch (error) {
        console.error('Admin general settings error:', error);
        await ctx.replyWithMarkdown('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©', getAdminSettingsKeyboard());
    }
}

// ğŸ†• ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø± ÙÙŠ Ø§Ù„Ø¥Ø¯Ù…Ù†
async function handleAdminCommands(ctx, text) {
    const session = ctx.session;
    
    try {
        // FIRST: Handle all specific admin steps
        if (session.adminStep === 'search_user') {
            await handleAdminSearchUser(ctx, text);
            return;
        }

        if (session.adminStep === 'broadcast') {
            await handleAdminBroadcast(ctx, text);
            return;
        }

        if (session.adminStep === 'select_payment_system') {
            await handleAdminSelectPaymentSystem(ctx, text);
            return;
        }

        if (session.adminStep === 'edit_price_and_payment') {
            await handleAdminEditPriceAndPayment(ctx, text);
            return;
        }

        if (session.adminStep === 'select_subscription_edit') {
            await handleAdminSelectSubscriptionEdit(ctx, text);
            return;
        }

        // SECOND: Handle navigation and main commands
        switch (text) {
            case 'ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…':
                await handleAdminStats(ctx);
                break;
                
            case 'ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†':
                ctx.session.adminStep = 'users';
                await ctx.replyWithMarkdown('ğŸ‘¥ *Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†*', getAdminUsersKeyboard());
                break;
                
            case 'ğŸ’° Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹':
                ctx.session.adminStep = 'payments';
                await ctx.replyWithMarkdown('ğŸ’° *Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹*', getAdminPaymentsKeyboard());
                break;
                
            case 'âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª':
                ctx.session.adminStep = 'settings';
                await ctx.replyWithMarkdown('âš™ï¸ *Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©*', getAdminSettingsKeyboard());
                break;

            case 'ğŸ“¢ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±':
                ctx.session.adminStep = 'broadcast';
                await ctx.replyWithMarkdown(
                    'ğŸ“¢ *Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¬Ù…Ø§Ø¹ÙŠ*\n\n' +
                    'âœï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:'
                );
                break;

            case 'ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…':
                ctx.session.adminStep = 'search_user';
                await ctx.replyWithMarkdown(
                    'ğŸ” *Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…*\n\n' +
                    'ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…:\n' +
                    'â€¢ Ø¢ÙŠØ¯ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…\n' +
                    'â€¢ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…\n' +
                    'â€¢ Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ 1xBet\n\n' +
                    'ğŸ” Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø¨Ø­Ø«:'
                );
                break;

            case 'ğŸ”§ Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„Ø¨ÙˆØª':
                await handleAdminToggleMaintenance(ctx);
                break;

            case 'ğŸ’° ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ø¯ÙØ¹':
                await handleAdminPriceAndPaymentSettings(ctx);
                break;
                
            case 'âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©':
                await handleAdminGeneralSettings(ctx);
                break;
                
            case 'ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†':
                await handleAdminReset(ctx);
                break;

            case 'ğŸ”™ Ø±Ø¬ÙˆØ¹':
                ctx.session.adminStep = 'main';
                await ctx.replyWithMarkdown('ğŸ”™ *Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©*', getAdminMainKeyboard());
                break;

            // ... (Ø¨Ù‚ÙŠØ© Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ)
        }
    } catch (error) {
        console.error('Admin commands error:', error);
        await ctx.replyWithMarkdown('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ù…Ø±', getAdminMainKeyboard());
    }
}

// ... (Ø¨Ù‚ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ)

console.log('âœ… Dual Payment System Integrated Successfully!');

// ğŸš€ START BOT
bot.launch().then(() => {
    console.log('ğŸ‰ SUCCESS! AI GOAL Predictor v15.4 with DUAL PAYMENT is RUNNING!');
    console.log('ğŸ’³ Payment Systems: Binance + Bank Transfer');
    console.log('ğŸ‘¤ Developer:', CONFIG.DEVELOPER);
    console.log('ğŸ“¢ Channel:', CONFIG.CHANNEL);
    console.log('ğŸŒ Health check: http://localhost:' + PORT);
    console.log('ğŸ”„ Keep alive: http://localhost:' + PORT + '/keep-alive');
    console.log('ğŸ”§ Admin ID:', CONFIG.ADMIN_ID);
}).catch(console.error);

// âš¡ Graceful shutdown
process.once('SIGINT', () => bot.stop('SIGINT'));
process.once('SIGTERM', () => bot.stop('SIGTERM'));

console.log('âœ… AI Goal Prediction System with Dual Payment Ready!');
